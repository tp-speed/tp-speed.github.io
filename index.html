<!DOCTYPE html>	
<html lang="en">
<head>
	<meta charset="UTF-8">
	<title>Document</title>	
	<script src="/static/js/jquery.js"></script>
	<script src="/static/js/amcharts.js"></script>
	<script src="/static/js/serial.js"></script>
	<script src="/static/js/light.js"></script>
</head>
<body>
	<h1 style="text-align: center;"> Скорость </h1>
	<div id="speedchart" 
		style="width: 90%; height: 500px; margin: 10px auto;"></div>

	<h1 style="text-align: center;"> Пинги </h1>
	<div id="pingchart" 
		style="width: 90%; height: 500px; margin: 10px auto;"></div>
	
	<script>
		function getStatistic(callback) {
			$.get("/stat/", function(data) {
			  	callback(data['data']);
			});
		}

		getStatistic(function(data) {

			var speedChartData = []
			var pingChartData = []

	    	for(var i = 0; i < data.length; i++) {

	    		current = data[i];

	    		speedChartData.push({
		            date: new Date(current['date'] * 1000),
		            speed: current['speed']
	        	});	        	

	        	pingChartData.push({
		            date: new Date(current['date'] * 1000),
		            ping: current['ping']
	        	});	
	    	}
	    	
			var speedChart = AmCharts.makeChart("speedchart", {
			    "type": "serial",
			    "theme": "light",
			    "pathToImages": "http://www.amcharts.com/lib/3/images/",
			    "dataProvider": speedChartData,
			    "valueAxes": [{
			        "axisAlpha": 0.2,
			        "dashLength": 1,
			        "position": "left"
			    }],
			    "mouseWheelZoomEnabled":true,
			    "graphs": [{
			        "id":"g1",
			        "balloonText": "[[category]]<br/><b><span style='font-size:14px;'>value: [[value]]</span></b>",
			        "bullet": "round",
			        "bulletBorderAlpha": 1,
					"bulletColor":"#FFFFFF",
			        "hideBulletsCount": 50,
			        "title": "red line",
			        "valueField": "speed",
					"useLineColorForBulletBorder":true
			    }],
			    "chartScrollbar": {
			        "autoGridCount": true,
			        "graph": "g1",
			        "scrollbarHeight": 40
			    },
			    "chartCursor": {
			        "cursorPosition": "mouse"
			    },
			    "categoryField": "date",
			    "categoryAxis": {
			        "parseDates": true,
			        "minPeriod": "mm",		        
			        "axisColor": "#DADADA",
			        "dashLength": 1,
			        "minorGridEnabled": true
			    }
			});

			var pingChart = AmCharts.makeChart("pingchart", {
			    "type": "serial",
			    "theme": "light",
			    "pathToImages": "http://www.amcharts.com/lib/3/images/",
			    "dataProvider": pingChartData,
			    "valueAxes": [{
			        "axisAlpha": 0.2,
			        "dashLength": 1,
			        "position": "left"
			    }],
			    "mouseWheelZoomEnabled":true,
			    "graphs": [{
			        "id":"g1",
			        "balloonText": "[[category]]<br/><b><span style='font-size:14px;'>value: [[value]]</span></b>",
			        "bullet": "round",
			        "bulletBorderAlpha": 1,
					"bulletColor":"#FFFFFF",
			        "hideBulletsCount": 50,
			        "title": "red line",
			        "valueField": "ping",
					"useLineColorForBulletBorder":true
			    }],
			    "chartScrollbar": {
			        "autoGridCount": true,
			        "graph": "g1",
			        "scrollbarHeight": 40
			    },
			    "chartCursor": {
			        "cursorPosition": "mouse"
			    },
			    "categoryField": "date",
			    "categoryAxis": {
			        "parseDates": true,
			        "minPeriod": "mm",		        
			        "axisColor": "#DADADA",
			        "dashLength": 1,
			        "minorGridEnabled": true
			    }
			});

			//chart.addListener("rendered", zoomChart);
			//zoomChart();
	    });

	
		// this method is called when chart is first inited as we listen for "dataUpdated" event
		function zoomChart() {
		    // different zoom methods can be used - zoomToIndexes, zoomToDates, zoomToCategoryValues
		    chart.zoomToIndexes(chartData.length - 40, chartData.length - 1);
		}
		
	</script>
</body>
</html>